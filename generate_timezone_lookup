#!/bin/bash -f

output="timezones.js"

echo "// generated file - DO NOT EDIT" > $output
echo "//" >> $output
echo "let tzLookup = [" >> $output


while read line; do
    firstChar=${line:0:1}
    if [ $firstChar != "#" ]; then  
        echo -n "$line" | awk 'BEGIN {ORS=""} {print "{abbr:\"" $1 "\"," "offset:\"" $NF ":00"; print "\"" ",name:\""; for(i=2;i<=NF-1;i++) printf $i " "}' \
        | sed 's/UTC+/+/g'                                               \
        | sed 's/UTC\-/\-/g'                                             \
        | sed 's/UTC\±/+/g'                                              \
        | sed 's/UTC\−/-/g'                                              \
        | sed 's/30:00/30/g'                                             \
        | sed 's/45:00/45/g' >> $output

        echo '"},' >> $output

    fi

done < "timezone.data"

echo "];" >> $output
